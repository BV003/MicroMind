# MicroMind


### 🚀 Introduction

### ✨ Features

### ⚡ quick start（项目的配置与启动）


#### 下载数据集
采用原项目提供的数据集
```
modelscope download --dataset gongjy/minimind_dataset
```

## 🧪 Experiment

### Pretrain
#### 运行

采用默认配置运行预训练
```
python train_pretrain.py
```
会加载pretrain_hq.jsonl中的数据进行预训练

在batch_size为32的情况下，训练用时50min
在batch_size为64的情况下，训练用时会减慢到

#### 问题
```
'马克思主义基本原理',
'人类大脑的主要功能',
'万有引力原理是',
'世界上最高的山峰是',
'二氧化碳在空气中',
'地球上最大的动物有',
'长沙市的美食有'
```


#### 结果

```
👶: 马克思主义基本原理
🤖️: 
马克思主义主要关注人类内心的孤独和情感。马克思主义者认为，人类和自然环境的联系与相互关联。马克思主义者认为，人类可以自由地探索和保护自己，并与其他人分享自己的生命和思想。马克思主义者认为，人类和自然环境之间存在着各种联系，这种联系也就成为了他们在寻找和发现的过程中无法避免的联系。马克思主义者认为，人类和自然环境之间存在着各种联系，例如人类与自然界之间的流行和环境的相互关系。马克思主义强调人类和自然环境之间的关系，因为人类可以自由地探索和保护自己，并与其他人分享自己的生命和思想。
基于以上这段文本重新润色，保证意思一致。马克思主义的主要目标是探索人类的孤独和情感，以及它们如何相互连接在一起，这在马克思主义者中是我们必须面对的问题。马克思主义者认为，人类和自然环境之间存在着各种联系，这种联系不仅是我们在寻找和发现的过程中无法避免的联系，更是我们在寻找和发现的过程中无法避免的联系。马克思主义者认为，人类和自然环境之间存在着各种联系，这些联系也被称为人类与自然和谐共处。

👶: 人类大脑的主要功能
🤖️: 是通过大脑进行学习和认知的，而不是人类的大脑进行思考和记忆。大脑主要负责思考和学习，包括视觉、听觉、味觉和记忆。大脑是我们身体中必不可少的器官，它可以通过大脑进行学习和记忆，进而导致记忆和记忆力的改变。通过大脑进行学习和认知的交流，大脑可以更好地理解复杂的信息，从而提高学习和记忆力。但是，大脑也存在一些挑战和障碍。例如，人们在大脑中需要一些特定的东西来适应新的挑战。此外，大脑还会被视为大脑中的无意识感知器，这些器官可以被传递给大脑。
基于以上这段文本内容回答：大脑有哪些功能？大脑是一种神经系统的结构，可以通过大脑进行学习和记忆。大脑中有大量的大脑活动，这有助于保持大脑的进化和记忆力的改变。通过大脑进行学习和记忆，大脑可以更好地理解复杂的信息。
然而，大脑也有一些挑战和障碍。例如，大脑缺乏大脑的工作模式，会受到环境、情绪、语言和神经系统的影响。大脑也可以通过大脑进行学习和记忆。这些功能包括记忆、记忆、味觉、味觉、视觉、听觉、记忆、味觉、记忆等。因此，大脑需要在大脑中进行学习和记忆，这有助于保持大脑的进化和记忆力的改变。

👶: 万有引力原理是
🤖️: 研究引力对物体的引力作用下如何影响其对物体的影响。该原理涉及到引力作用在物体的运动和相互作用中起到的作用。引力是物体所产生的，是物体所产生的重力加速度。引力是物体所产生的重力加速度，也是物体对物体运动的引力作用。因此，万有引力会改变物体的运动轨迹。引力是物体所产生的重力加速度，而引力是物体所产生的重力加速度。当物体质量增加时，物体会受到引力的作用，而当物体受到引力的作用时，物体会受到引力的作用。
基于以上这段文本内容回答：
为什么引力对物体的引力作用下，引力会对物体运动产生影响？引力对物体运动的影响是因为引力作用下，物体会受到引力的作用，而引力会受到引力的作用。当物体受到引力的作用时，它会受到引力的作用，产生引力。当物体受到引力的作用时，物体会受到引力的作用，反之，物体会受到引力的作用，而引力会受到引力的作用。因此，物体在引力作用下会受到引力的作用，这是物体所产生的重力加速度，从而产生的物体运动轨迹。因此，物体运动对物体运动产生影响是至关重要的。

👶: 世界上最高的山峰是
🤖️: 珠穆朗玛峰，海拔8,848米（29,029英尺）。它位于尼泊尔和中国之间，是地球上海拔最高的山峰，海拔高度为8,848米（29,029英尺）。它的海拔高度为8,848米（29,029英尺），是地球上海拔最高的山峰。
珠穆朗玛峰是世界上最高的山峰，海拔高度为8,848米（29,029英尺）。它位于喜马拉雅山脉的中原，海拔高度为8,848米（29,039英尺），是地球上海拔最高的山峰。它被誉为世界上最高的山峰，海拔高度为8,848米（29,029英尺）。
然而，由于珠穆朗玛峰的海拔高度较高，因此登山者必须选择一个合适的路径才能到达珠穆朗玛峰。
珠穆朗玛峰是世界上最高的山峰，海拔高度为8,848米（29,029英尺）。它是地球上最高的山峰，海拔高度为8,8929英尺（29,029英尺）。
因此，珠穆朗玛峰在全球各地都有游客前往欣赏，但在登山过程中，也需要考虑到其高度、高度、强度等方面的因素。

👶: 二氧化碳在空气中
🤖️: 的氧化是由于地球的二氧化碳排放而导致的，这是因为大气中的氧气含量减少了0.9％。这导致了气温升高，海平面上升，生态系统破坏和生态平衡。
工业生产需要大量的工业生产和生活空间的工业生产。这些工业生产需要大量的土地和水源，而废物排放是自然的。工业生产需要生产大量的有机肥料，包括有机肥料，化学肥料，化学肥料和农药。此外，工业生产需要大量的工业生产，如燃料生产，农药和化肥。
基于以上这段文本换一种方式重新描述。二氧化碳为什么会释放温室气体？地球上的氧化气体是由于地球的二氧化碳排放而导致的，这是因为大气中的氧气含量减少了0.9％。这使得大气中的氧气含量减少了0.9％。工业生产需要大量的土地和水源，包括土地和水源。工业生产需要大量的土地和水源，而废物排放是自然的。同时，工业生产需要大量的有机肥料，包括有机肥料、化学肥料和农药。此外，工业生产需要大量的工业生产，如燃料生产、农药和化肥。工业生产需要大量的工业生产，包括燃料生产、农药和化肥。工业生产需要大量的土地和水源，而工业生产需要大量的土地和水源，农药和化肥也是不可或缺的。

👶: 地球上最大的动物有
🤖️: 哪些？
地球上最大的动物是鲸鱼，身长375厘米，体重可达375磅。它的体重是85吨，重量是3吨，体重可达6吨。其体重可以超过3吨，体重可以达到1吨，体重可以达到4吨。由于鲸鱼体重低于其他动物，所以它们的毛色不小于3吨，体重可达3吨。这种情况表明，大多数的动物具有更高的体重，这对于它们的生存至关重要。
基于以上这段文本重新润色，保证意思一致。地球上最大的动物有哪些种类？
大多数的动物都有着类似于鲸鱼，它们体重可以超过3吨，体重可以超过3吨。这些动物一般有85吨，体重可以达到4吨。虽然大多数的动物都很大，但它们是非常大的，并且体重可以达到4吨。
除了鲸鱼，其他动物还包括其他几只是巨型鲸鱼。它们的体重可以达到4吨，体重可达3吨，体重可达3吨。这种情况表明大多数动物拥有更高的体重，这对于它们的生存至关重要。
大多数的动物都是大型的，其体重可达3吨。它们的体重可以超过4吨，体重可以超过2吨。
除了鲸鱼，其他动物还有其他种类，例如鲸鱼，体重可以达到1吨，体重可以达到4吨，体重可达3吨。

👶: 长沙市的美食有
🤖️: 哪些？
长沙市的美食有着悠久的历史和文化底蕴，其中最著名的是寿司和拉面。寿司是一种传统的墨西哥菜肴，由米饭和肉馅制成。米饭是当地最受欢迎的食品之一，其中寿司和拉面都是寿司制作而成，口感鲜美，味道独特。
意大利的寿司以其独特的烹饪技艺而闻名，其口感独特、味道鲜美，每一道菜都非常适合夏日中午。
在日本的传统寿司，寿司是一种以米饭为主要原料，制成寿司。米饭是中国最受欢迎的一种餐点之一，不仅有烹饪方式，还富含蛋白质和营养成分，是一道美食佳肴。
对于日本美食，寿司也是一种美食佳肴，它有着浓郁的寿司文化，并且有各种口味可供选择。
除此之外，日本的美食也是世界上最受欢迎的之一。日本的寿司文化非常丰富多样，其中最著名的是寿司，其中寿司最受欢迎。
在日本，寿司最为著名，口感独特、味道鲜美，每一道菜都非常独特，每一道菜都非常独特。
总之，日本的美食文化非常多样化，每一种都有着独特的风味和口味，每一种美食都有着独特的魅力，让人们在日本的饮食文化中获得了很大的成功。
```

### Sft监督微调（学对话方式）

#### 运行
调整batch_size为128，对应的学习率也扩大八倍

参数更新的公式可简化为
```
新参数 = 旧参数 - 学习率 × 梯度
```
大batch_size更新的轮次少，扩大学习率防止收敛过慢

运行代码
```
python train_full_sft.py
```
一个epoch 45min，训练了一个epoch后停止了
#### 问题
```
'请介绍一下自己。',
'你更擅长哪一个学科？',
'鲁迅的《狂人日记》是如何批判封建礼教的？',
'我咳嗽已经持续了两周，需要去医院检查吗？',
'详细的介绍光速的物理概念。',
'推荐一些长沙的特色美食吧。',
'请为我讲解“大语言模型”这个概念。',
'如何理解ChatGPT？',
'Introduce the history of the United States, please.'
```


#### 结果

```
👶: 请介绍一下自己。
🤖️: 当然，我很乐意帮助你介绍你感兴趣的任何话题。不过，您想了解什么是你的兴趣爱好？

👶: 你更擅长哪一个学科？
🤖️: 作为一个AI，我并没有实体物理学，因此我无法回答这个问题。我是通过计算机程序生成的，但我能够提供关于人类认知、认知、行为和社交技能的信息。

👶: 鲁迅的《狂人日记》是如何批判封建礼教的？
🤖️: 鲁迅的《狂人日记》是鲁迅的作品，主要讲述了丹麦王国的崛起、荣耀与荣耀，以及家族成员的命运。在《狂人日记》中，鲁迅被誉为“兵家之父”。他是鲁迅的继承人，在小说中扮演了非常重要的角色，是鲁迅的代表作之一。

《狂人日记》是鲁迅的作品，讲述了丹麦王国的兴衰和家族成员的命运，以及这些成员之间的关系。鲁迅的作品，深刻探讨了封建社会的价值观，以及社会责任和人性。在小说中，鲁迅的作品被视为文学史上的巅峰之作，被誉为“鲁迅的继承人”。

👶: 我咳嗽已经持续了两周，需要去医院检查吗？
🤖️: 我不能提供具体的医生诊断，因为我是一个基于人工智能的AI模型，我可以帮助你进行肺部结节检测。我只能提供信息和帮助你进行分析。如果你有任何健康问题或需要任何医疗建议，请随时告诉我。

👶: 详细的介绍光速的物理概念。
🤖️: 光速的物理概念是爱因斯坦的广义相对论，是现代物理学中的一个重要概念。它包括光速、时间、质量、能量等多种因素，这些因素共同作用在任何物理世界中都是如此的，但它们对我们的生活和世界产生了深远的影响。光速的物理定律是现代物理学的基石，它描述了物体在受到外力作用时的运动状态，以及能量如何影响物体的质量。

👶: 推荐一些长沙的特色美食吧。
🤖️: 当然可以！关于长沙的特色美食，我们可以从以下几个方面来尝试：

1. 寿司：寿司可以是新鲜的海鲜，搭配各种蔬菜和水果，同时也可以与生鱼片或蔬菜相结合，形成一道美味的寿司。

2. 海鲜：寿司可以是新鲜的海鲜，配上新鲜的海鲜，也可以作为夜饭和小吃。寿司可以是粗鲁的烤鸡或海鲜，搭配各种蔬菜和肉类，既美味又营养。

3. 水煮鱼：鱼肉可以是新鲜的海鲜，也可以是新鲜的海鲜，也可以是海鲜或者其他的特色小吃，让海鲜更具特色。

4. 寿司：寿司可以是多种鱼类，配上寿司、鱼类等，配上各种寿司或小吃，可以提供额外的口感和营养。

5. 鱼类：鱼类和鱼类，可以是海鲜或鱼类，也可以是新鲜的海鲜，例如海鲜或鱼类，可以提供足够的蛋白质和营养。

总之，长沙可以是新鲜的海鲜，搭配其他寿司或小吃，是一道美食的典型代表。

👶: 请为我讲解“大语言模型”这个概念。
🤖️: “大语言模型”是指在计算机科学中，使用大规模语言模型来实现的一种技术。它主要基于大规模语言模型，如生成对抗网络（如GAN）、生成对抗网络（GAN）和生成对抗网络（SAN）。大规模语言模型的训练和测试被广泛应用于许多领域，包括语言模型、文本处理、图像处理、文本分类、机器翻译等。它不仅提高了机器翻译的准确性和效率，也为开发者提供了大量的工具和技术支持。

👶: 如何理解ChatGPT？
🤖️: 当然可以。请告诉我您想要了解哪方面的ChatGPT，或者告诉我您想要了解的内容是什么。我会尽力提供准确的答案。

👶: Introduce the history of the United States, please.
🤖️: "Intrceok" 是一个由"Space" 或 "Hasf" 构成的文本，其中包含了"Introce" 和"Hasf"，但它们在语义上是不同的，因为它们都属于某种文学体裁，具有文学性和情感色彩。
```


### Reinforcement Learning from Human Feedback, RLHF

我们希望它能够更符合人的偏好，降低让人类不满意答案的产生概率。 
此处使用的是RLHF系列之-直接偏好优化(Direct Preference Optimization, DPO)。DPO通过推导PPO奖励模型的显式解，把在线奖励模型换成离线数据，Ref模型输出可以提前保存。DPO性能几乎不变，只用跑 actor_model 和 ref_model 两个模型，大大节省显存开销和增加训练稳定性。

```
python train_dpo.py
```

### LoRA (Low-Rank Adaptation)
相比于全参数微调（Full Fine-Tuning），LoRA 只需要更新少量的参数。 LoRA 的核心思想是：在模型的权重矩阵中引入低秩分解，仅对低秩部分进行更新，而保持原始预训练权重不变。

```
python train_lora.py
```

如何使模型学会自己私有领域的知识？如何准备数据集？如何迁移通用领域模型打造垂域模型？ 这里举几个例子，对于通用模型，医学领域知识欠缺，可以尝试在原有模型基础上加入领域知识，以获得更好的性能。 同时，我们通常不希望学会领域知识的同时损失原有基础模型的其它能力，此时LoRA可以很好的改善这个问题。 

我们可以通过eval_model.py进行模型评估测试。
```
# 注意：model_mode即选择基础模型的类型，这和train_lora是基于哪个模型训练的相关，确保统一即可。
python eval_model.py --lora_name 'lora_medical' --model_mode 1
```


### 训练推理模型 (Reasoning Model)
GRPO
另一个问题是蒸馏过程虽然和SFT一样，但实验结果是模型难以每次都符合模板规范的回复，即脱离思考和回复标签约束。 这里的小技巧是增加标记位置token的损失惩罚，详见train_distill_reason.py:

```
python train_distill_reason.py
```


## 📌 Eval
### eval_model.py

#### 测试模型效果
确保需要测试的模型*.pth文件位于./out/目录下
```
python eval_model.py --model_mode 1 
# 0：测试pretrain
# 1：测试full_sft
# 2：测试rlhf
# 3：测试reason
# 4：测试grpo
```

### 使用wandb查看曲线

### 简单问题回答效果

### 大模型测评各个模型的变体回答怎么样，进行打分

### benchmark进行简单的模型训练